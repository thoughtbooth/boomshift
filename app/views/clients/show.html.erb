<p id="notice"><%= notice %></p>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><%= @client.fname %> <%= @client.lname %></h3>
  </div>
  <div class="panel-body">
    <p>
      <strong>First Name:</strong>
      <%= @client.fname %>
    </p>
    <p>
      <strong>Last Name:</strong>
      <%= @client.lname %>
    </p>
    <p>
      <strong>Address 1:</strong>
      <%= @client.addr1 %>
    </p>
    <p>
      <strong>Address 2:</strong>
      <%= @client.addr2 %>
    </p>
    <p>
      <strong>City:</strong>
      <%= @client.city %>
    </p>
    <p>
      <strong>State:</strong>
      <%= @client.state %>
    </p>
    <p>
      <strong>Country:</strong>
      <%= @client.country %>
    </p>
    <p>
      <strong>Phone:</strong>
      <%= @client.phone %>
    </p>
    <%= link_to edit_client_path(@client), class: "btn btn-default" do %>
      <i class="glyphicon glyphicon-edit"></i> Edit
    <% end %>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Available Services</h3>
  </div>
  <div class="panel-body">
    <table class="table table-striped table-hover">
      <thead>
      <tr>
        <th>Service</th>
        <th>Description</th>
        <th>Enrolled?</th> <!-- This is for the Enrollment button -->
        <th>As Of</th>
        <th>Preferences</th>
      </tr>
      </thead>
      <tbody>
        <% @services = current_user.business.services.all %>
        <% if @services.count > 0 %>
          <% @services.each do |s| %>
            <tr>
              <td><%= s.name %></td>
              <td><%= s.description %></td>
              <% @enrollment = Enrollment.where(client_id: @client.id, service_id: s.id, deleted_at: nil).last %>
              <% if @enrollment.nil? %>
                <td>
                  <%= link_to enroll_path(client_id: @client.id, service_id: s.id), class: 'btn btn-link' do %>
                    <span data-toggle="tooltip" data-placement="top" title="Enroll in <%= s.name.downcase %>"><i class="glyphicon glyphicon-unchecked"></i> No</span>
                  <% end %>
                </td>
                <td></td>
                <td></td>
              <% else %>
                <td>
                  <%= link_to @enrollment, client_id: @client.id, method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-link' do %>
                    <span data-toggle="tooltip" data-placement="top" title="Unenroll from <%= s.name.downcase %>"><i class="glyphicon glyphicon-check"></i> Yes</span>
                  <% end %>
                </td>
                <td><%= @enrollment.created_at.strftime("%B #{@enrollment.created_at.day.ordinalize}, %Y %l:%M %p") %></td>
                <td>
                  <!--%= @enrollment.preferences %-->
                  <%= render 'enrollments/form', enrollment: @enrollment %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td>You haven't created any services yet. <%= link_to 'Go set up some services...', services_path %></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        <% end %>
      <tbody>
    </table>
  </div>
</div>


<%= link_to 'Back', clients_path %>
