<p id="notice"><%= notice %></p>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title"><%= @client.fname %> <%= @client.lname %></h3>
  </div>
  <div class="panel-body">
    <p>
      <strong>First Name:</strong>
      <%= @client.fname %>
    </p>
    <p>
      <strong>Last Name:</strong>
      <%= @client.lname %>
    </p>
    <p>
      <strong>Address 1:</strong>
      <%= @client.addr1 %>
    </p>
    <p>
      <strong>Address 2:</strong>
      <%= @client.addr2 %>
    </p>
    <p>
      <strong>City:</strong>
      <%= @client.city %>
    </p>
    <p>
      <strong>State:</strong>
      <%= @client.state %>
    </p>
    <p>
      <strong>Country:</strong>
      <%= @client.country %>
    </p>
    <p>
      <strong>Phone:</strong>
      <%= @client.phone %>
    </p>
    <%= link_to edit_client_path(@client), class: "btn btn-default" do %>
      <i class="glyphicon glyphicon-edit"></i> Edit
    <% end %>
  </div>
</div>

<div class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Enrolled Services</h3>
  </div>
  <div class="panel-body">
    <table class="table table-striped table-hover">
      <thead>
      <tr>
        <th>Service</th>
        <th>Description</th>
        <th>Preferences</th>
        <th>As Of</th>
        <th></th>
      </tr>
      </thead>
      <tbody>
        <!-- Instead of using @client_services, put the service info in the description (already done) and pull from there. -->
        <% @enrollments = Enrollment.where(client_id: @client.id) %> <!-- fix this -->
        <% if @enrollments.count > 0 %>
          <% @enrollments.each do |enrollment| %>
            <tr>
              <td><%= enrollment.service_name %></td>
              <td><%= enrollment.service_description %></td>
              <td>
                <%= enrollment.preferences %>
                <%= render 'enrollments/form', enrollment: enrollment, client_id: @client.id %>
              </td>
              <td><%= enrollment.created_at.strftime("%B #{enrollment.created_at.day.ordinalize}, %Y %l:%M %p") %></td>
              <td>
                <%= link_to enrollment_path(id: enrollment, client_id: @client.id), method: :delete, data: { confirm: 'Are you sure?' }, class: 'btn btn-default' do %>
                  <i class="glyphicon glyphicon-remove"></i> Unenroll
                <% end %>
              </td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td>Click the Add button to add an enrollment.</td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        <% end %>
      <tbody>
    </table>
    <!-- Button trigger modal to add enrollments -->
    <button type="button" class="btn btn-default" data-toggle="modal" data-target="#AddEnrollmentModal">
      <span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
      Add
    </button>
  </div>
</div>

<!-- Modal for Adding Enrollments -->
<div class="modal fade" id="AddEnrollmentModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Services I Offer</h4>
      </div>
      <div class="modal-body">
        <table class="table table-striped table-hover">
          <thead>
            <tr>
              <th>Service</th>
              <th>Description</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <% @services = current_user.business.services.all %>
            <% @services.each do |service| %>
              <tr>
                <td><%= service.name %></td>
                <td><%= service.description %></td>
                <td>
                  <% @enrollment = Enrollment.first %>
                  <% if @enrollment.nil? %>
                    <%= link_to enroll_path(client_id: @client.id, service_id: service.id), class: 'btn btn-default' do %>
                      <i class="glyphicon glyphicon-ok"></i> Enroll
                    <% end %>
                  <% else %>
                    <i class="glyphicon glyphicon-check"></i> Enrolled
                  <% end %>
                </td>
              </tr>
            <% end %>
          <tbody>
        </table>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<%= link_to 'Back', clients_path %>
